<!-- Floating Assistant Widget -->
<div class="floating-assistant">
    <!-- Help Bubble -->
    <div class="assistant-bubble" data-translate="assistant.bubble">
        ðŸ‘‹ How can I help you?
    </div>
    
    <!-- Main Toggle Button -->
    <button class="assistant-toggle" aria-label="Quick Actions">
        <i class="bi bi-chat-dots-fill"></i>
        <i class="bi bi-x-lg"></i>
    </button>
    
    <!-- Quick Action Menu -->
    <div class="assistant-menu">
        <!-- Language Selector -->
        <div class="assistant-item language-selector">
            <button class="assistant-btn" data-action="language">
                <i class="bi bi-globe2"></i>
                <span data-translate="assistant.language">Language</span>
            </button>
            <div class="language-submenu">
                <button class="lang-option" data-lang="en">
                    <span class="lang-flag">ðŸ‡¬ðŸ‡§</span>
                    <span>English</span>
                </button>
                <button class="lang-option" data-lang="id">
                    <span class="lang-flag">ðŸ‡®ðŸ‡©</span>
                    <span>Indonesia</span>
                </button>
                <button class="lang-option" data-lang="zh">
                    <span class="lang-flag">ðŸ‡¨ðŸ‡³</span>
                    <span>ä¸­æ–‡</span>
                </button>
                <button class="lang-option" data-lang="ja">
                    <span class="lang-flag">ðŸ‡¯ðŸ‡µ</span>
                    <span>æ—¥æœ¬èªž</span>
                </button>
            </div>
        </div>
        
        <!-- WhatsApp -->
        <div class="assistant-item">
            <a href="https://wa.me/6281291549791" target="_blank" class="assistant-btn whatsapp-btn">
                <i class="bi bi-whatsapp"></i>
                <span data-translate="assistant.whatsapp">WhatsApp</span>
            </a>
        </div>
        
        <!-- Email -->
        <div class="assistant-item">
            <a href="mailto:info@oceanexmarine.com" class="assistant-btn email-btn">
                <i class="bi bi-envelope-fill"></i>
                <span data-translate="assistant.email">Email Us</span>
            </a>
        </div>
        
        <!-- Contact Form -->
        <div class="assistant-item">
            <a href="index.html#section_5" class="assistant-btn contact-btn">
                <i class="bi bi-chat-left-text-fill"></i>
                <span data-translate="assistant.contact">Contact Form</span>
            </a>
        </div>
    </div>
</div>

<style>
    /* Floating Assistant Styles */
    .floating-assistant {
        position: fixed;
        bottom: 100px;
        right: 24px;
        z-index: 9999;
        font-family: 'Poppins', sans-serif;
    }
    
    @media (max-width: 768px) {
        .floating-assistant {
            bottom: 90px;
            right: 16px;
        }
    }
    
    /* Help Bubble */
    .assistant-bubble {
        position: absolute;
        bottom: 8px;
        right: 75px;
        background: white;
        color: #333;
        padding: 12px 18px;
        border-radius: 0;
        border-bottom-right-radius: 0;
        font-size: 14px;
        font-weight: 500;
        white-space: nowrap;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        animation: bubble-bounce 3s ease-in-out infinite;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .assistant-bubble:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 25px rgba(0,0,0,0.2);
    }
    
    .floating-assistant.active .assistant-bubble {
        opacity: 0;
        visibility: hidden;
        transform: translateX(20px);
    }
    
    @keyframes bubble-bounce {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-5px);
        }
    }
    
    /* Bubble arrow */
    .assistant-bubble::after {
        content: '';
        position: absolute;
        right: -8px;
        bottom: 10px;
        width: 0;
        height: 0;
        border-left: 10px solid white;
        border-top: 6px solid transparent;
        border-bottom: 6px solid transparent;
    }
    
    @media (max-width: 480px) {
        .assistant-bubble {
            display: none;
        }
    }
    
    /* Main Toggle Button */
    .assistant-toggle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #CA1B1A 0%, #e02d2c 100%);
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(202, 27, 26, 0.4);
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: visible;
    }
    
    .assistant-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 30px rgba(202, 27, 26, 0.5);
    }
    
    .assistant-toggle i {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
        line-height: 1;
    }
    
    .assistant-toggle .bi-chat-dots-fill {
        opacity: 1;
        transform: translate(-50%, -50%) rotate(0deg) scale(1);
    }
    
    .assistant-toggle .bi-x-lg {
        opacity: 0;
        transform: translate(-50%, -50%) rotate(-90deg) scale(0.5);
    }
    
    .floating-assistant.active .assistant-toggle .bi-chat-dots-fill {
        opacity: 0;
        transform: translate(-50%, -50%) rotate(90deg) scale(0.5);
    }
    
    .floating-assistant.active .assistant-toggle .bi-x-lg {
        opacity: 1;
        transform: translate(-50%, -50%) rotate(0deg) scale(1);
    }
    
    /* Pulse Animation */
    .assistant-toggle::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: inherit;
        animation: pulse-ring 2s ease-out infinite;
        z-index: -1;
    }
    
    .floating-assistant.active .assistant-toggle::before {
        animation: none;
    }
    
    @keyframes pulse-ring {
        0% {
            transform: scale(1);
            opacity: 0.5;
        }
        100% {
            transform: scale(1.5);
            opacity: 0;
        }
    }
    
    /* Menu Container */
    .assistant-menu {
        position: absolute;
        bottom: 75px;
        right: 0;
        display: flex;
        flex-direction: column;
        gap: 12px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .floating-assistant.active .assistant-menu {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }
    
    /* Menu Items */
    .assistant-item {
        position: relative;
        opacity: 0;
        transform: translateY(20px) scale(0.8);
        transition: all 0.3s ease;
    }
    
    .floating-assistant.active .assistant-item {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    
    .floating-assistant.active .assistant-item:nth-child(1) { transition-delay: 0.05s; }
    .floating-assistant.active .assistant-item:nth-child(2) { transition-delay: 0.1s; }
    .floating-assistant.active .assistant-item:nth-child(3) { transition-delay: 0.15s; }
    .floating-assistant.active .assistant-item:nth-child(4) { transition-delay: 0.2s; }
    
    /* Button Styles */
    .assistant-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 20px;
        background: white;
        border: none;
        border-radius: 0;
        color: #333;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        text-decoration: none;
        white-space: nowrap;
    }
    
    .assistant-btn:hover {
        transform: translateX(-5px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    
    .assistant-btn i {
        font-size: 18px;
        width: 24px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
    }
    
    /* WhatsApp Button */
    .whatsapp-btn {
        background: #25D366;
        color: white;
    }
    
    .whatsapp-btn:hover {
        background: #20bd5a;
        color: white;
    }
    
    /* Email Button */
    .email-btn i {
        color: #CA1B1A;
    }
    
    /* Contact Button */
    .contact-btn {
        background: #CA1B1A;
        color: white;
    }
    
    .contact-btn:hover {
        background: #a81615;
        color: white;
    }
    
    /* Language Selector */
    .language-selector {
        position: relative;
    }
    
    .language-selector .assistant-btn i {
        color: #CA1B1A;
    }
    
    .language-submenu {
        position: absolute;
        right: 100%;
        top: 50%;
        transform: translateY(-50%);
        margin-right: 10px;
        background: white;
        border-radius: 0;
        padding: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        display: flex;
        flex-direction: column;
        gap: 4px;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }
    
    .language-selector:hover .language-submenu,
    .language-selector.active .language-submenu {
        opacity: 1;
        visibility: visible;
    }
    
    .lang-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        background: transparent;
        border: none;
        border-radius: 0;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: #333;
        transition: all 0.2s ease;
        white-space: nowrap;
    }
    
    .lang-option:hover {
        background: #fff0f0;
    }
    
    .lang-option.active {
        background: #CA1B1A;
        color: white;
    }
    
    .lang-flag {
        font-size: 20px;
    }
    
    /* Mobile adjustments */
    @media (max-width: 480px) {
        .assistant-btn span {
            display: none;
        }
        
        .assistant-btn {
            padding: 0;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .assistant-btn i {
            margin: 0;
            width: auto;
        }
        
        .language-submenu {
            right: auto;
            left: auto;
            bottom: 100%;
            top: auto;
            transform: none;
            margin-right: 0;
            margin-bottom: 10px;
        }
    }
</style>

<script>
    // Floating Assistant Functionality
    // Use IIFE to run immediately (for dynamically loaded content)
    (function initFloatingAssistant() {
        const assistant = document.querySelector('.floating-assistant');
        const toggle = document.querySelector('.assistant-toggle');
        const bubble = document.querySelector('.assistant-bubble');
        const languageSelector = document.querySelector('.language-selector');
        const langOptions = document.querySelectorAll('.lang-option');
        const contactBtn = document.querySelector('.assistant-btn.contact-btn');
        
        if (!assistant || !toggle) return;
        
        // Toggle menu
        toggle.addEventListener('click', function() {
            assistant.classList.toggle('active');
        });
        
        // Bubble click also toggles menu
        if (bubble) {
            bubble.addEventListener('click', function() {
                assistant.classList.toggle('active');
            });
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!assistant.contains(e.target)) {
                assistant.classList.remove('active');
            }
        });
        
        // Language selector toggle for mobile
        if (languageSelector) {
            languageSelector.querySelector('.assistant-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                languageSelector.classList.toggle('active');
            });
        }
        
        // Language selection
        langOptions.forEach(option => {
            option.addEventListener('click', function() {
                const lang = this.dataset.lang;
                
                // Update active state
                langOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                
                // Apply translation using existing translator
                if (typeof translator !== 'undefined') {
                    translator.setLanguage(lang);
                }
                
                // Close menus
                if (languageSelector) languageSelector.classList.remove('active');
                assistant.classList.remove('active');
                
                // Show confirmation
                showToast(lang === 'en' ? 'Language changed to English' : 
                          lang === 'id' ? 'Bahasa diubah ke Indonesia' :
                          lang === 'zh' ? 'è¯­è¨€å·²æ›´æ”¹ä¸ºä¸­æ–‡' : 
                          'è¨€èªžãŒæ—¥æœ¬èªžã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸ');
            });
        });
        
        // Set initial active language
        const currentLang = localStorage.getItem('preferred-language') || 'en';
        langOptions.forEach(opt => {
            if (opt.dataset.lang === currentLang) {
                opt.classList.add('active');
            }
        });
        
        // Close menu when clicking contact form link
        if (contactBtn) {
            contactBtn.addEventListener('click', function() {
                assistant.classList.remove('active');
            });
        }
        
        // Toast notification function
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'assistant-toast';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 180px;
                right: 24px;
                background: #333;
                color: white;
                padding: 12px 24px;
                border-radius: 0;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                opacity: 0;
                transform: translateY(10px);
                transition: all 0.3s ease;
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateY(0)';
            }, 10);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(10px)';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }
    })();
</script>
